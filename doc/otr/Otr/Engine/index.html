<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Engine (otr.Otr.Engine)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">otr</a> &#x00BB; <a href="../index.html">Otr</a> &#x00BB; Engine</nav><header class="odoc-preamble"><h1>Module <code><span>Otr.Engine</span></code></h1><p>Message processing</p></header><nav class="odoc-toc"><ul><li><a href="#message-processing">Message processing</a></li></ul></nav><div class="odoc-content"><h3 id="message-processing"><a href="#message-processing" class="anchor"></a>Message processing</h3><p>Either when an OTR session should be established, or if a message containing OTR data is received, the corresponding function should be called to decrypt or encrypt the OTR data, or initiate a handshake.</p><div class="odoc-spec"><div class="spec value anchored" id="val-start_otr"><a href="#val-start_otr" class="anchor"></a><code><span><span class="keyword">val</span> start_otr : <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span> <a href="../State/index.html#type-session">State.session</a> * string</span></code></div><div class="spec-doc"><p><code>start_otr session</code> is <code>session', out</code>, which initiates an OTR session. <code>out</code> should be sent to the communication partner, <code>session'</code> used in further API calls. The <code>session</code> is reset, and <code>out</code> contains an OTR query message (content depends on the configured <a href="../State/index.html#type-version"><code>State.version</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-send_otr"><a href="#val-send_otr" class="anchor"></a><code><span><span class="keyword">val</span> send_otr : 
  <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../State/index.html#type-session">State.session</a>
  * <span>string option</span>
  * <span>[ <span>`Warning of string</span> <span><span>| `Sent</span> of string</span> <span><span>| `Sent_encrypted</span> of string</span> ]</span></span></code></div><div class="spec-doc"><p><code>send_otr session message</code> is <code>session', out, user_data</code>, where <code>out</code> should be sent to the communication partner and <code>user_data</code> be presented to the user. Depending on the current <code>session</code> state and configured <a href="../State/index.html#type-policy"><code>State.policy</code></a>, <code>out</code> can be encrypted, or the initiation of an OTR session, or the plain text. <code>session'</code> should be used in subsequent API calls. <code>user_data</code> contains more information on what happened with <code>message</code> (whether it was sent in plain, encrypted, or not at all).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_otr"><a href="#val-end_otr" class="anchor"></a><code><span><span class="keyword">val</span> end_otr : <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span> <a href="../State/index.html#type-session">State.session</a> * <span>string option</span></span></code></div><div class="spec-doc"><p><code>end_otr session</code> is <code>session', out</code>, which ends the OTR session. <code>out</code> should be sent to the communication partner, <code>session'</code> should be used in subsequent calls.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-handle"><a href="#val-handle" class="anchor"></a><code><span><span class="keyword">val</span> handle : 
  <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../State/index.html#type-session">State.session</a> * <span>string option</span> * <span><a href="../State/index.html#type-ret">State.ret</a> list</span></span></code></div><div class="spec-doc"><p><code>handle session data</code> is <code>session', out, ret</code>, which handles received data. <code>out</code> should be sent to the communication partner (might contain data to complete a handshake), <code>ret</code> should be presented to the user. <code>handle</code> potentially decrypts the incoming message, or proceeds in the handshake setup. <code>session'</code> should be used in subsequent calls.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start_smp"><a href="#val-start_smp" class="anchor"></a><code><span><span class="keyword">val</span> start_smp : 
  <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?question</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../State/index.html#type-session">State.session</a> * <span>string option</span> * <span><a href="../State/index.html#type-ret">State.ret</a> list</span></span></code></div><div class="spec-doc"><p><code>start_smp session ~question shared_secret</code> is <code>session', out, ret</code>, which starts the <a href="https://en.wikipedia.org/wiki/Socialist_millionaire">socialist millionairs problem</a> if the <code>session</code> is already established, using potentially the <code>question</code> and <code>shared_secret</code>. <code>out</code> should be sent to the communication partner, and <code>ret</code> presented to the user. <code>session'</code> should be used in subsequent calls.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-abort_smp"><a href="#val-abort_smp" class="anchor"></a><code><span><span class="keyword">val</span> abort_smp : <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span> <a href="../State/index.html#type-session">State.session</a> * <span>string option</span> * <span><a href="../State/index.html#type-ret">State.ret</a> list</span></span></code></div><div class="spec-doc"><p><code>abort_smp session</code> is <code>session', out, ret</code>, which aborts an unfinished SMP. <code>out</code> should be sent to the communication patner, and <code>ret</code> presented to the user. <code>session'</code> should be used in subsequent calls.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-answer_smp"><a href="#val-answer_smp" class="anchor"></a><code><span><span class="keyword">val</span> answer_smp : 
  <span><a href="../State/index.html#type-session">State.session</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../State/index.html#type-session">State.session</a> * <span>string option</span> * <span><a href="../State/index.html#type-ret">State.ret</a> list</span></span></code></div><div class="spec-doc"><p><code>answer_smp session secret</code> is <code>session', out, ret</code>, which answers the SMP. <code>out</code> should be sent to the communication partner, and <code>ret</code> presented to the user. The given <code>secret</code> is compared (in a zero-knowledge style) with the communication partners secret. <code>session'</code> should be used in subsequent calls.</p></div></div></div></body></html>
